function numtall(num){if(num>1000){if(num>10000){return(num/10000).toFixed(1)+'w'}else{return(num/1000).toFixed(1)+'k'}}else{return num}}function number_format(number,decimals=0,dec_point='.',thousands_sep=','){number=(number+'').replace(/[^0-9+-Ee.]/g,'');var n=!isFinite(+number)?0:+number,prec=!isFinite(+decimals)?0:Math.abs(decimals),sep=(typeof thousands_sep==='undefined')?',':thousands_sep,dec=(typeof dec_point==='undefined')?'.':dec_point,s='',toFixedFix=function(n,prec){var k=Math.pow(10,prec);return''+Math.floor(n*k)/k};s=(prec?toFixedFix(n,prec):''+Math.floor(n)).split('.');var re=/(-?\d+)(\d{3})/;while(re.test(s[0])){s[0]=s[0].replace(re,"$1"+sep+"$2")}if((s[1]||'').length<prec){s[1]=s[1]||'';s[1]+=new Array(prec-s[1].length+1).join('0')}return s.join(dec)}function getplay(id,e,mid){$(e).addClass('cur');$.ajax({async:true,url:vhost+"/WeApi/Song/oldAllCountPlay_Songs/mid/"+mid,type:'GET',dataType:'json',timeout:10000,error:function(){TME.warn('加载超时，请刷新页面')},success:function(r){var data=r.data;var chart=new G2.Chart({container:id,forceFit:true,height:330});chart.source(data,{month:{range:[0,1]}});chart.tooltip({crosshairs:{type:'line'}});chart.axis('数据',{label:{formatter:function formatter(val){return val}}});chart.line().position('日期*数据').color('来源',['#0060ff','#31c27c','#1f84e4','#f83','#C20C0C']);chart.point().position('日期*数据').color('来源',['#0060ff','#31c27c','#1f84e4','#f83','#C20C0C']).size(4).shape('circle').style({stroke:'#fff',lineWidth:1});chart.render()}})}function getsong(){$.ajax({async:true,url:vhost+"/WeApi/Song/okAndno",type:'GET',dataType:'json',timeout:10000,error:function(){TME.warn('加载超时，请刷新页面')},success:function(r){if(r.code==1){$(".data-list").hide();$(".data-list-song").hide();$(".data-play").hide();$(".data-count").hide();$(".no-list").show();return}else{$(".data-list").hide();$(".data-list-song").hide();$(".data-play").hide();$(".data-count").hide();$(".load-list").show();$.getJSON(vhost+"/WeApi/Song/playDayData",function(r){var returo=r;$(".data-list-song .singerinfo .t b").text(number_format(r.DayAddCount));var data=[{type:'QQ音乐',value:r.count}];var count=0;for(var i=0;i<1;i++){$(".data-list-song .am-li p b").eq(i).html(numtall(data[i]['value']));count=count+data[i]['value']}var sliceNumber=0.01;G2.Shape.registerShape('interval','sliceShape',{draw:function draw(cfg,container){var points=cfg.points;var path=[];path.push(['M',points[0].x,points[0].y]);path.push(['L',points[1].x,points[1].y-sliceNumber]);path.push(['L',points[2].x,points[2].y-sliceNumber]);path.push(['L',points[3].x,points[3].y]);path.push('Z');path=this.parsePath(path);return container.addShape('path',{attrs:{fill:cfg.color,path:path}})}});$("#mountSong").html("");var chart=new G2.Chart({container:'mountSong',forceFit:true,height:300});chart.guide().html({position:['50%','38%'],html:'<div style="color:#8c8c8c;font-size: 16px;text-align: center;width: 10em;">累计播放<br><span id="playcount" style="color:#8c8c8c;font-size:18px">0</span></div>',alignX:'middle',alignY:'middle'});chart.source(data);chart.coord('theta',{innerRadius:0.70});chart.tooltip({showTitle:false});chart.intervalStack().position('value').color('type',['#31c27c','#1f84e4','#f83','#C20C0C']).shape('sliceShape');chart.render();$("#playcount").html(number_format(count));$.ajax({async:true,url:vhost+"/WeApi/Song/playlistdata",type:'GET',dataType:'json',timeout:10000,error:function(){TME.warn('加载超时，请刷新页面')},success:function(r){$(".tops-list").html("");for(var x=0;x<r.count;x++){var html='<div data-mid="'+r.data[x].songname+'" class="t-h list"><div class="num">'+(x+1)+'</div><div class="songname">'+r.data[x].songname+'</div><div class="singer">'+r.data[x].singername+'</div><div class="album">'+r.data[x].albumname+'</div><div class="play">'+number_format(r.data[x].playnum)+'</div><div class="edit">趋势 <i class="icon anticon icon-down"></i><i class="icon anticon icon-up"></i></div><div id="mata_'+(x+1)+'" class="goData"></div></div>';$(".tops-list").append(html)}var indexCurdataPlay;$(".tops-list .list").click(function(){for(var i=0;i<$(".tops-list .list").length;i++){$(".tops-list .list").eq(i).removeClass('cur')}if(indexCurdataPlay!=$(this).index()){indexCurdataPlay=$(this).index();$(".tops-list .goData").html("");getplay('mata_'+$(this).children('.num').text(),this,$(this).attr("data-mid"))}else{$(".tops-list .goData").html("");$(this).removeClass('cur');indexCurdataPlay=null}})}});$.ajax({async:true,url:vhost+"/WeApi/Song/oldAllCountPlay",type:'GET',dataType:'json',timeout:10000,error:function(){TME.warn('加载超时，请刷新页面')},success:function(r){var data=r.data;$("#mountFans").html("");var chart=new G2.Chart({container:'mountFans',forceFit:true,height:450});chart.source(data,{month:{range:[0,1]}});chart.tooltip({crosshairs:{type:'line'}});chart.axis('数据',{label:{formatter:function formatter(val){return val}}});chart.line().position('日期*数据').color('来源',['#0060ff','#31c27c','#1f84e4','#f83','#C20C0C']);chart.point().position('日期*数据').color('来源',['#0060ff','#31c27c','#1f84e4','#f83','#C20C0C']).size(4).shape('circle').style({stroke:'#fff',lineWidth:1});chart.render()}});getsongslist(0);$(".load-list").hide();$(".data-list-song").show();$(".data-play").show();$(".data-count").show()})}}})}function getsongslist(index){$.ajax({async:true,url:vhost+"/WeApi/Song/songlist/list/"+index,type:'GET',dataType:'json',timeout:10000,error:function(){TME.warn('加载超时，请刷新页面')},success:function(r){$(".songs-list").html("");$(".song-list .select-lyer .list").html("");for(var z=0;z<r.albumcount;z++){$(".song-list .select-lyer .list").append('<li data-albumid="'+r.album[z]['albumid']+'">'+r.album[z]['albumname']+'</li>')}$(".song-list .select-lyer .input sm").html(r.album[index]['albumname']);$(".song-list .select-lyer .list li").on("click",function(){getsongslist($(this).index())});for(var x=0;x<r.songcount;x++){var html='<div data-mid="'+r.songs[x].songname+'" class="t-h list"><div class="num">'+(x+1)+'</div><div class="songname">'+r.songs[x].songname+'</div><div class="singer">'+r.songs[x].singername+'</div><div class="album">'+r.list+'</div><div class="play">'+number_format(r.songs[x].playnum)+'</div><div class="edit">趋势 <i class="icon anticon icon-down"></i><i class="icon anticon icon-up"></i></div><div id="mata_s_'+(x+1)+'" class="goData"></div></div>';$(".songs-list").append(html)}var indexCurdataPlay_s;$(".songs-list .list").click(function(){for(var i=0;i<$(".songs-list .list").length;i++){$(".songs-list .list").eq(i).removeClass('cur')}if(indexCurdataPlay_s!=$(this).index()){indexCurdataPlay_s=$(this).index();$(".songs-list .goData").html("");getplay('mata_s_'+$(this).children('.num').text(),this,$(this).attr("data-mid"))}else{$(".songs-list .goData").html("");$(this).removeClass('cur');indexCurdataPlay_s=null}})}})}function getfans(){$(".no-list").hide();$(".data-list").hide();$(".data-play").hide();$(".data-list-song").hide();$(".data-count").hide();$(".load-list").show();$.getJSON(vhost+"/WeApi/Fans/yesterdayAndCountFans",function(r){var returo=r;$(".singerinfo .t b").text(number_format(r.yesterday_qqmusic+r.yesterday_kugou+r.yesterday_xiami));var data=[{type:'QQ音乐',value:r.qqmusic},{type:'酷狗音乐',value:r.kugou}];var count=0;for(var i=0;i<2;i++){$(".am-li p b").eq(i).html(numtall(data[i]['value']));count=count+data[i]['value']}var sliceNumber=0.01;G2.Shape.registerShape('interval','sliceShape',{draw:function draw(cfg,container){var points=cfg.points;var path=[];path.push(['M',points[0].x,points[0].y]);path.push(['L',points[1].x,points[1].y-sliceNumber]);path.push(['L',points[2].x,points[2].y-sliceNumber]);path.push(['L',points[3].x,points[3].y]);path.push('Z');path=this.parsePath(path);return container.addShape('path',{attrs:{fill:cfg.color,path:path}})}});$("#mountNode").html("");var chart=new G2.Chart({container:'mountNode',forceFit:true,height:300});chart.guide().html({position:['50%','38%'],html:'<div style="color:#8c8c8c;font-size: 16px;text-align: center;width: 10em;">粉丝总量<br><span id="fanscount" style="color:#8c8c8c;font-size:18px">0</span></div>',alignX:'middle',alignY:'middle'});chart.source(data);chart.coord('theta',{innerRadius:0.70});chart.tooltip({showTitle:false});chart.intervalStack().position('value').color('type',['#31c27c','#1f84e4','#f83','#C20C0C']).shape('sliceShape');chart.render();$("#fanscount").html(number_format(count));$.ajax({async:true,url:vhost+"/WeApi/Fans/oldAllCountFans",type:'GET',dataType:'json',timeout:10000,error:function(){TME.warn('加载超时，请刷新页面')},success:function(r){var data=r.data;$("#mountFans").html("");var chart=new G2.Chart({container:'mountFans',forceFit:true,height:450});chart.source(data,{month:{range:[0,1]}});chart.tooltip({crosshairs:{type:'line'}});chart.axis('数据',{label:{formatter:function formatter(val){return val}}});chart.line().position('日期*数据').color('来源',['#31c27c','#1f84e4']);chart.point().position('日期*数据').color('来源',['#31c27c','#1f84e4']).size(4).shape('circle').style({stroke:'#fff',lineWidth:1});chart.render()}});$(".load-list").hide();$(".data-list").show();$(".data-count").show()})}var locationHref=window.location.href;meunhref=locationHref.match(/meun\/(\S*)/);$(".list .meun span").click(function(){var length=$(this).parents(".meun").children($("span")).length;for(var i=0;i<length;i++){$(this).parents(".meun").children($("span")[i]).removeClass("cur")}$(this).addClass("cur");shref('/meun/'+$(".list .meun span.cur").index());if($(".list .meun span.cur").index()==1){getsong();return}if(meunhref!=null){if(meunhref[1]!=$(".list .meun span.cur").index()){getfans();return}}getfans()});if(meunhref!=null){$(".list .meun span").eq(meunhref[1])[0].click()}